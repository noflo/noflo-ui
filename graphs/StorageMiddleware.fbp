INPORT=Dispatch.IN:IN
OUTPORT=Passed.OUT:PASS
OUTPORT=NewActions.OUT:NEW

'noflo:ready,storage:load:*,storage:save:*,storage:delete:*,workspace:project' -> ROUTES Dispatch(ui/DispatchAction)
Dispatch PASS -> IN Passed(core/Merge)

# New actions generated by this middleware
'storage:db' -> ACTION StorageDbAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:load:all' -> ACTION StorageInitialLoadAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:projects' -> ACTION StorageProjectsAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:graphs' -> ACTION StorageGraphsAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:components' -> ACTION StorageComponentsAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:specs' -> ACTION StorageSpecsAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:runtimes' -> ACTION StorageRuntimesAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:project' -> ACTION StorageProjectAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:graph' -> ACTION StorageGraphAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:component' -> ACTION StorageComponentAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:spec' -> ACTION StorageSpecAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:stored:runtime' -> ACTION StorageRuntimeAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:ready' -> ACTION StorageReadyAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:removed:project' -> ACTION RemovedProjectAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:removed:graph' -> ACTION RemovedGraphAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:removed:component' -> ACTION RemovedComponentAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:removed:spec' -> ACTION RemovedSpecAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:removed:runtime' -> ACTION RemovedRuntimeAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:error' -> ACTION StorageErrorAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'workspace:error' -> ACTION WorkspaceErrorAction(ui/SetAction) OUT -> IN NewActions
# Actions manipulated and passed on by this middleware
'workspace:project' -> ACTION WorkspaceProjectAction(ui/SetAction) OUT -> IN Passed

# Prepare IndexedDB database
'noflo-ui' -> STRING DbName(strings/SendString)
Dispatch HANDLE[0] -> IN DbName OUT -> NAME PrepareStorage(ui/PrepareStorage)
PrepareStorage DB -> IN StorageDbAction
# When we have database, we want to trigger loading of local data
PrepareStorage DB -> IN StorageInitialLoadAction
PrepareStorage ERROR -> IN StorageErrorAction

# Loading data from the DB
Dispatch HANDLE[1] -> IN LoadData(ui/LoadData)
LoadData PROJECTS -> IN StorageProjectsAction
LoadData GRAPHS -> IN StorageGraphsAction
LoadData COMPONENTS -> IN StorageComponentsAction
LoadData SPECS -> IN StorageSpecsAction
LoadData RUNTIMES -> IN StorageRuntimesAction
'5' -> PACKETS WaitForComplete(ui/WaitFor)
LoadData PROJECTS -> IN WaitForComplete
LoadData GRAPHS -> IN WaitForComplete
LoadData COMPONENTS -> IN WaitForComplete
LoadData SPECS -> IN WaitForComplete
LoadData RUNTIMES -> IN WaitForComplete
WaitForComplete OUT -> IN StorageReadyAction
LoadData ERROR -> IN StorageErrorAction

# Saving data to the DB
Dispatch HANDLE[2] -> IN SaveData(ui/SaveData)
SaveData PROJECT -> IN StorageProjectAction
SaveData GRAPH -> IN StorageGraphAction
SaveData COMPONENT -> IN StorageComponentAction
SaveData SPEC -> IN StorageSpecAction
SaveData RUNTIME -> IN StorageRuntimeAction
SaveData ERROR -> IN StorageErrorAction

# Removing data from the DB
Dispatch HANDLE[3] -> IN DeleteData(ui/DeleteData)
DeleteData PROJECT -> IN RemovedProjectAction
DeleteData GRAPH -> IN RemovedGraphAction
DeleteData COMPONENT -> IN RemovedComponentAction
DeleteData SPEC -> IN RemovedSpecAction
DeleteData RUNTIME -> IN RemovedRuntimeAction
DeleteData ERROR -> IN StorageErrorAction

# Mapping locally-available data to project being opened
Dispatch HANDLE[4] -> IN PopulateProjectWorkspace(ui/PopulateProjectData)
PopulateProjectWorkspace OUT -> IN WorkspaceProjectAction
PopulateProjectWorkspace ERROR -> IN WorkspaceErrorAction
